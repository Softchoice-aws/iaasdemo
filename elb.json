{
  "AWSTemplateFormatVersion":"2010-09-09",
  "Description":"Provision ELB for Demo",

  "Parameters":{
    "shortClientName":{"Type":"String"},
    "longClientName":{"Type":"String"},
    "publicSubnet0Id":{"Type":"String"},
    "publicSubnet1Id":{"Type":"String"},
    "elbSecurityGroupId":{"Type":"String"},
    "vpcId":{"Type": "String"}
  },
  "Resources":{
    "publicELB":{
      "Type":"AWS::ElasticLoadBalancingV2::LoadBalancer",
      "Properties":{
        "SecurityGroups":[{"Ref":"elbSecurityGroupId"}],
        "Subnets":[{"Ref":"publicSubnet0Id"},{"Ref":"publicSubnet1Id"}],
        "Tags":[
          {"Key":"Name","Value":"elb-public"}
        ]
      }
    },
    "publicListener":{
      "Type":"AWS::ElasticLoadBalancingV2::Listener",
      "Properties":{
        "DefaultActions":[{
          "Type":"forward",
          "TargetGroupArn":{"Ref":"elbTarget"}
        }],
        "LoadBalancerArn":{"Ref":"publicELB"},
        "Port":"80",
        "Protocol":"HTTP"
      }
    },
    "elbTarget":{
      "Type":"AWS::ElasticLoadBalancingV2::TargetGroup",
      "Properties":{
        "HealthCheckIntervalSeconds":"10",
        "HealthCheckPath":"/index.html",
        "HealthCheckPort":"80",
        "HealthCheckProtocol":"HTTP",
        "HealthCheckTimeoutSeconds":"5",
        "HealthyThresholdCount":"3",
        "Matcher":{"HttpCode":"200"},
        "Port":"80",
        "Protocol":"HTTP",
        "Tags":[
          {"Key":"Name","Value":"elb-public-target-group"}
        ],
        "UnhealthyThresholdCount":"3",
        "VpcId":{"Ref":"vpcId"}
      }
    }
  },
  "Outputs":{
    "publicELBId":{"Value":{"Ref":"publicELB"}},
    "elbListenerId":{"Value":{"Ref":"publicListener"}},
    "elbTargetId":{"Value":{"Ref":"elbTarget"}},
    "elbCanonical":{"Value":{"Fn::GetAtt":["publicELB","CanonicalHostedZoneID"]}},
    "elbName":{"Value":{"Fn::GetAtt":["publicELB","DNSName"]}}
  }
}
